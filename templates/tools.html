{% extends "base.html" %}
{% block content %}

<style>
  /* Tools page overrides */
  #tools-page a { color: #343a40; }
  .theme-dark #tools-page a { color: #d1d5db; }
  #tools-page a:hover { text-decoration: underline; }

  .tool-list { list-style: none; margin: 0; padding: 0; }
  .tool-list-item { display: flex; align-items: center; gap: 10px; padding: 6px 0; }
  .tool-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  .tool-name { font-weight: 600; line-height: 1.2; }
  .tool-tags { display: inline-flex; gap: 4px; margin-left: 8px; }
  .tool-actions { display: flex; gap: 6px; margin-left: auto; }

  /* Category list link color override */
  #tools-categories a { color: #343a40; }
  .theme-dark #tools-categories a { color: #d1d5db; }
</style>

<div id="tools-page" class="dp-cols" style="grid-template-columns: 260px 1fr;">
  <aside>
    <div class="d-flex align-items-center justify-content-between">
      <h6 class="text-uppercase text-muted mb-2">Categories</h6>
      <details class="ms-2">
        <summary class="btn btn-outline-primary btn-sm">+ Category</summary>
        <form class="mt-2" hx-post="/tools/category/add" hx-swap="none">
          <div class="input-group input-group-sm">
            <input name="name" class="form-control" placeholder="Category name" required />
            <button class="btn btn-primary" type="submit">Add</button>
          </div>
        </form>
      </details>
    </div>
    <ul class="list-unstyled m-0 p-0 mt-2" id="tools-categories">
      {% for cat in tools.categories %}
        <li class="mb-1 d-flex align-items-center justify-content-between gap-2">
          <a class="text-decoration-none" href="#cat-{{ cat.id }}">{{ cat.name }}</a>
          {% if not cat['items'] or (cat['items'] | length) == 0 %}
          <form hx-post="/tools/category/delete" hx-swap="none" class="m-0">
            <input type="hidden" name="category_id" value="{{ cat.id }}"/>
            <button class="btn btn-danger btn-sm" type="submit" title="Delete category" aria-label="Delete category">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
                <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 7h16"/>
                  <path d="M10 11v6"/>
                  <path d="M14 11v6"/>
                  <path d="M6 7l1 13a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-13"/>
                  <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/>
                </g>
              </svg>
            </button>
          </form>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </aside>
  <section>
    <!-- Add Tool control -->
    <details class="mb-3">
      <summary class="btn btn-outline-primary btn-sm">Add Tool +</summary>
      <form class="mt-2" hx-post="/tools/item/add" hx-swap="none">
        <div class="row g-2">
          <div class="col-12 col-md-3">
            <input name="name" class="form-control form-control-sm" placeholder="Name" required />
          </div>
          <div class="col-12 col-md-4">
            <input name="url" class="form-control form-control-sm" placeholder="https://…" required />
          </div>
          <div class="col-12 col-md-3">
            <select name="category_id" class="form-select form-select-sm" required>
              <option value="" selected disabled>Category…</option>
              {% for cat in tools.categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-12 col-md-6">
            <input name="tags" class="form-control form-control-sm" placeholder="tags (comma separated)" />
          </div>
          <div class="col-12 col-md-3">
            <input name="color" class="form-control form-control-sm" placeholder="#ff9900" pattern="#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})" title="Hex color like #RGB or #RRGGBB" />
          </div>
          <div class="col-12 col-md-3 d-grid">
            <button class="btn btn-primary btn-sm" type="submit">Add Tool</button>
          </div>
        </div>
      </form>
    </details>

    {% for cat in tools.categories %}
      <div id="cat-{{ cat.id }}" class="mb-4">
        <h5 class="mb-3">{{ cat.name }}</h5>
        <ul class="tool-list">
          {% for item in cat['items'] %}
            <li class="tool-list-item">
              <span class="tool-dot" style="background: {{ item.color or '#9ca3af' }};"></span>
              <a href="{{ item.url }}" target="_blank" rel="noopener" class="tool-name text-decoration-none">{{ item.name }}</a>
              {% if item.keywords %}
                <span class="tool-tags small">
                  {% for k in item.keywords %}
                    <span class="badge text-bg-secondary">{{ k }}</span>
                  {% endfor %}
                </span>
              {% endif %}
              <span class="tool-actions">
                <a
                  href="javascript:void(0)"
                  role="button"
                  class="btn btn-outline-secondary btn-sm"
                  hx-get="/tools/item/edit?item_id={{ item.id }}&category_id={{ cat.id }}"
                  hx-target="#toolEditModal .modal-content"
                  hx-swap="innerHTML"
                  hx-on:htmx:afterSwap="new bootstrap.Modal(document.getElementById('toolEditModal')).show()"
                  data-bs-toggle="modal"
                  data-bs-target="#toolEditModal"
                  title="Edit"
                  aria-label="Edit">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25Zm17.71-10.04a1.003 1.003 0 0 0 0-1.42l-2.5-2.5a1.003 1.003 0 0 0-1.42 0l-1.83 1.83l3.75 3.75l1.99-1.66Z"/></svg>
                </a>
                <form hx-post="/tools/item/delete" hx-swap="none" class="m-0">
                  <input type="hidden" name="item_id" value="{{ item.id }}"/>
                  <input type="hidden" name="category_id" value="{{ cat.id }}"/>
                  <button class="btn btn-danger btn-sm" type="submit" title="Delete" aria-label="Delete">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
                      <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 7h16"/>
                        <path d="M10 11v6"/>
                        <path d="M14 11v6"/>
                        <path d="M6 7l1 13a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-13"/>
                        <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/>
                      </g>
                    </svg>
                  </button>
                </form>
              </span>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  </section>
</div>

<!-- Modal shell for editing tools -->
<div class="modal fade" id="toolEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <!-- Content loaded dynamically via HTMX -->
    </div>
  </div>
</div>

{% endblock %}
