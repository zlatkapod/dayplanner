
<div id="todos" class="dp-todos">
  {% if plan.todos %}
    <ul id="todo-list" data-date="{{ plan.date }}" class="list-unstyled d-flex flex-column gap-2">
      {% for t in plan.todos %}
        {% set is_done = t.startswith('âœ“ ') %}
        {% set raw = t[2:] if is_done else t %}
        <li class="todo-item d-flex align-items-center gap-2 w-100 {{ 'todo-done' if is_done }}" data-text="{{ t }}">
          <span class="todo-pick flex-grow-1 {{ 'text-success' if is_done }}" data-text="{{ raw }}">
            {{ raw }}
          </span>
          {% if not is_done %}
          <form hx-post="/todo/move_next" hx-target="#todos" hx-swap="outerHTML" class="m-0">
            <input type="hidden" name="date" value="{{ plan.date }}"/>
            <input type="hidden" name="index" value="{{ loop.index0 }}"/>
            <button class="btn btn-warning btn-sm" type="submit" title="Move to next day" aria-label="Move to next day">&raquo;</button>
          </form>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="dp-muted">No todos yet. Add some above.</p>
  {% endif %}


  <div class="mt-3">
    <h6 class="text-uppercase text-muted mb-2">What I liked about today?</h6>
    <form hx-post="/reflection" hx-trigger="input changed delay:600ms" hx-swap="none">
      <input type="hidden" name="date" value="{{ plan.date }}"/>
      <textarea name="text"
                class="form-control form-control-sm dp-note"
                placeholder="Write your reflection..."
                rows="3"
                oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
                hx-on::load="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
      >{{ plan.reflection or '' }}</textarea>
    </form>
  </div>

  <div class="mt-3">
    <h6 class="text-uppercase text-muted mb-2">What did I dislike today?</h6>
    <form hx-post="/dislike" hx-trigger="input changed delay:600ms" hx-swap="none">
      <input type="hidden" name="date" value="{{ plan.date }}"/>
      <textarea name="text"
                class="form-control form-control-sm dp-note"
                placeholder="Write what you disliked..."
                rows="3"
                oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
                hx-on::load="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
      >{{ plan.dislike or '' }}</textarea>
    </form>
  </div>
</div>
