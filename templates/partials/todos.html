
<div id="todos" class="dp-todos">
  {% if plan.todos %}
    <ul id="todo-list" data-date="{{ plan.date }}" class="list-unstyled d-flex flex-column gap-2">
      {% for t in plan.todos %}
        {% set is_done = t.startswith('âœ“ ') %}
        {% set raw = t[2:] if is_done else t %}
        <li class="todo-item d-flex align-items-center gap-2 w-100 {{ 'todo-done' if is_done }}" data-text="{{ t }}">
          <span class="todo-pick flex-grow-1 {{ 'text-success' if is_done }}" data-text="{{ raw }}">
            {{ raw }}
          </span>
          <div class="ms-auto d-flex align-items-center gap-2">
            <form hx-post="/todo/done" hx-target="#todos" hx-swap="outerHTML" class="m-0">
              <input type="hidden" name="date" value="{{ plan.date }}"/>
              <input type="hidden" name="index" value="{{ loop.index0 }}"/>
              <button class="btn btn-success btn-sm" type="submit" title="Mark done" aria-label="Mark done">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
                  <path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/>
                </svg>
              </button>
            </form>
            <form hx-post="/todo/delete" hx-target="#todos" hx-swap="outerHTML" class="m-0">
              <input type="hidden" name="date" value="{{ plan.date }}"/>
              <input type="hidden" name="index" value="{{ loop.index0 }}"/>
              <button class="btn btn-danger btn-sm" type="submit" title="Delete" aria-label="Delete">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
                  <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 7h16"/>
                    <path d="M10 11v6"/>
                    <path d="M14 11v6"/>
                    <path d="M6 7l1 13a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-13"/>
                    <path d="M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/>
                  </g>
                </svg>
              </button>
            </form>
            <form hx-post="/todo/move_next" hx-target="#todos" hx-swap="outerHTML" class="m-0">
              <input type="hidden" name="date" value="{{ plan.date }}"/>
              <input type="hidden" name="index" value="{{ loop.index0 }}"/>
              <button class="btn btn-warning btn-sm" type="submit" title="Move to next day" aria-label="Move to next day">&raquo;</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="dp-muted">No todos yet. Add some above.</p>
  {% endif %}

  <div class="mt-3">
    <h6 class="text-uppercase text-muted mb-2">What I want to achieve today? Does this schedule make me happy about my life?</h6>
    <form hx-post="/note" hx-trigger="input changed delay:600ms" hx-swap="none">
      <input type="hidden" name="date" value="{{ plan.date }}"/>
      <textarea name="text"
                class="form-control form-control-sm dp-note"
                placeholder="Write your thoughts..."
                rows="3"
                oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
                hx-on::load="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
      >{{ plan.note or '' }}</textarea>
    </form>
  </div>

  <div class="mt-3">
    <h6 class="text-uppercase text-muted mb-2">What I liked about today?</h6>
    <form hx-post="/reflection" hx-trigger="input changed delay:600ms" hx-swap="none">
      <input type="hidden" name="date" value="{{ plan.date }}"/>
      <textarea name="text"
                class="form-control form-control-sm dp-note"
                placeholder="Write your reflection..."
                rows="3"
                oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
                hx-on::load="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
      >{{ plan.reflection or '' }}</textarea>
    </form>
  </div>
</div>
